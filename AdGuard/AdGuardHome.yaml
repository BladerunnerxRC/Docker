# ===== AdGuard Home minimal, hardened, DoH-only config =====
bind_host: 0.0.0.0

# --- Admin web UI ---
http:
  address: 0.0.0.0:80     # Change to 3000 if you prefer
  session_ttl: 720h

# --- DNS service ---
dns:
  bind_hosts:
    - 0.0.0.0
  port: 53
  # Serve both UDP and TCP locally; upstreams are forced to TCP/HTTPS below
  ratelimit: 200
  edns_client_subnet:
    enabled: false
  upstream_dns:
    # DoH-only, IP+SNI: no bootstrap required to start TLS
    - "https://1.1.1.1/dns-query#cloudflare-dns.com"
    - "https://1.0.0.1/dns-query#cloudflare-dns.com"
    - "https://94.140.14.14/dns-query#dns.adguard-dns.com"
    - "https://94.140.14.15/dns-query#dns.adguard-dns.com"
  use_tcp_upstream: true           # Prefer TCP to upstream (reliable through middleboxes)
  upstream_timeout: 8s
  # Local bootstrap for internal/cert lookups; doesnâ€™t gate startup
  bootstrap_dns:
    - 192.168.200.1:53             # Router DNS (LAN, no WAN dependency)
    - 9.9.9.9:53                   # Quad9 as fallback if you allow UDP/53 egress
  # If absolutely everything fails, try these (rarely used with DoH)
  fallback_dns:
    - 9.9.9.10
  cache_size: 268435456            # 256 MiB cache
  cache_ttl_min: 0
  cache_ttl_max: 0                 # Respect upstream TTL
  refuse_any: true
  blocked_hosts: []
  blocked_response_ttl: 10
  upstream_mode: parallel          # Query all upstreams, use fastest valid
  serve_http3: false               # You can enable later if you want (UDP/784, QUIC)
  # Local domain rewrites (examples)
  # rewrites:
  #   - domain: "ha.local"
  #     answer: "192.168.200.50"

# --- Access control (who can query you) ---
access:
  allowed_clients:
    - 192.168.200.0/24
    - 10.100.50.0/24
  disallowed_clients: []
  blocked_hosts: []

# --- Filters / Blocking (basic skeleton; add your lists in UI) ---
filters:
  - enabled: true
    url: https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt
    name: "AdGuard DNS Filter"
  - enabled: true
    url: https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
    name: "StevenBlack hosts"
whitelist_filters: []
user_rules: []

# --- Query log & stats ---
querylog:
  enabled: true
  file_enabled: true
  interval: 168h      # keep 7 days
statistics:
  enabled: true
  interval: 168h

# --- TLS for serving DoH to your LAN (optional; leave off until you have a cert) ---
tls:
  enabled: false
  server_name: "dns.home.lan"  # must match your cert CN/SAN if enabled
  force_https: false
  port_https: 443
  certificate_chain: ""
  private_key: ""
